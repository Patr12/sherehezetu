<!-- events/event_guests.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ event.title }} - Guests{% endblock %}

{% block extra_css %}
<style>
    .guest-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.2rem;
    }
    
    .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
    }
    
    .status-confirmed {
        background: #d4edda;
        color: #155724;
    }
    
    .status-pending {
        background: #fff3cd;
        color: #856404;
    }
    
    .status-cancelled {
        background: #f8d7da;
        color: #721c24;
    }
    
    .filter-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1><i class="fas fa-users me-2"></i> {{ event.title }} - Guests</h1>
        <p class="text-muted mb-0">
            <i class="fas fa-calendar me-1"></i> {{ event.date|date:"F d, Y" }} | 
            <i class="fas fa-map-marker-alt me-1"></i> {{ event.venue }}
        </p>
    </div>
    <div>
        <a href="{% url 'batch_add_guests' %}?event={{ event.id }}" 
           class="btn btn-success me-2">
            <i class="fas fa-user-plus me-2"></i> Add Guests
        </a>
        <a href="{% url 'event_detail' event.id %}" 
           class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-2"></i> Back to Event
        </a>
    </div>
</div>

<!-- Filters and Search -->
<div class="filter-card">
    <div class="row">
        <div class="col-md-6">
            <form method="GET" class="d-flex">
                <input type="text" name="search" class="form-control me-2" 
                       placeholder="Search guests..." value="{{ request.GET.search }}">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i>
                </button>
            </form>
        </div>
        <div class="col-md-6">
            <div class="d-flex justify-content-end">
                <div class="btn-group">
                    <a href="?status=all" 
                       class="btn btn-outline-secondary {% if not request.GET.status or request.GET.status == 'all' %}active{% endif %}">
                        All ({{ total_guests }})
                    </a>
                    <a href="?status=confirmed" 
                       class="btn btn-outline-success {% if request.GET.status == 'confirmed' %}active{% endif %}">
                        Confirmed ({{ confirmed_count }})
                    </a>
                    <a href="?status=pending" 
                       class="btn btn-outline-warning {% if request.GET.status == 'pending' %}active{% endif %}">
                        Pending ({{ pending_count }})
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Guest List Table -->
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Guest</th>
                        <th>Contact</th>
                        <th>Status</th>
                        <th>Invitation Sent</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for guest in guests %}
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="guest-avatar me-3">
                                    {{ guest.full_name|slice:":1"|upper }}
                                </div>
                                <div>
                                    <strong>{{ guest.full_name }}</strong>
                                    <div class="small text-muted">
                                        {{ guest.company|default:"No company" }}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div>
                                <i class="fas fa-envelope me-1 text-primary"></i>
                                {{ guest.email }}
                            </div>
                            {% if guest.phone %}
                            <div class="small text-muted">
                                <i class="fas fa-phone me-1"></i>
                                {{ guest.phone }}
                            </div>
                            {% endif %}
                        </td>
                        <td>
                            {% if guest.confirmed %}
                            <span class="status-badge status-confirmed">
                                <i class="fas fa-check-circle me-1"></i> Confirmed
                                {% if guest.checked_in_at %}
                                <br><small>Checked in: {{ guest.checked_in_at|date:"M d, H:i" }}</small>
                                {% endif %}
                            </span>
                            {% else %}
                            <span class="status-badge status-pending">
                                <i class="fas fa-clock me-1"></i> Pending
                            </span>
                            {% endif %}
                        </td>
                        <td>
                            {% if guest.invitation_sent %}
                            <span class="badge bg-success">
                                <i class="fas fa-paper-plane me-1"></i>
                                {{ guest.get_invitation_via_display }}
                            </span>
                            <br>
                            <small class="text-muted">{{ guest.invitation_sent_at|date:"M d, H:i" }}</small>
                            {% else %}
                            <span class="badge bg-secondary">Not Sent</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="{% url 'guest_detail' guest.id %}" 
                                   class="btn btn-outline-info" title="View">
                                    <i class="fas fa-eye"></i>
                                </a>
                                {% if not guest.invitation_sent %}
                                <a href="{% url 'officer_send_invite' guest.id %}" 
                                   class="btn btn-outline-success" title="Send Invitation">
                                    <i class="fas fa-paper-plane"></i>
                                </a>
                                {% endif %}
                                {% if not guest.confirmed %}
                                <a href="{% url 'check_in' guest.id %}" 
                                   class="btn btn-outline-primary" title="Check In">
                                    <i class="fas fa-check"></i>
                                </a>
                                {% endif %}
                                <a href="{% url 'download_invitation' guest.id %}" 
                                   class="btn btn-outline-secondary" title="Download Card">
                                    <i class="fas fa-download"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-5">
                            <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
                            <h4 class="text-muted">No guests found</h4>
                            <p class="text-muted">Add guests to start sending invitations</p>
                            <a href="{% url 'batch_add_guests' %}?event={{ event.id }}" 
                               class="btn btn-primary">
                                <i class="fas fa-user-plus me-2"></i> Add Guests
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Export and Actions -->
        <div class="d-flex justify-content-between align-items-center mt-4">
            <div>
                <a href="{% url 'export_guests' event.id %}?format=csv" 
                   class="btn btn-outline-secondary me-2">
                    <i class="fas fa-file-csv me-2"></i> Export CSV
                </a>
                <a href="{% url 'export_guests' event.id %}?format=pdf" 
                   class="btn btn-outline-danger">
                    <i class="fas fa-file-pdf me-2"></i> Export PDF
                </a>
            </div>
            <div>
                <a href="{% url 'send_event_invitations' event.id %}" 
                   class="btn btn-primary">
                    <i class="fas fa-paper-plane me-2"></i> Send All Invitations
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}